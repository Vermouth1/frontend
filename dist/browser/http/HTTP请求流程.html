<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP请求流程 | whisperwind</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/frontend/assets/css/0.styles.5583c977.css" as="style"><link rel="preload" href="/frontend/assets/js/app.9af0d489.js" as="script"><link rel="preload" href="/frontend/assets/js/2.92dfc871.js" as="script"><link rel="preload" href="/frontend/assets/js/7.dbd79068.js" as="script"><link rel="prefetch" href="/frontend/assets/js/10.2417283f.js"><link rel="prefetch" href="/frontend/assets/js/11.ce9d5501.js"><link rel="prefetch" href="/frontend/assets/js/12.99c97a8d.js"><link rel="prefetch" href="/frontend/assets/js/13.a192cdbb.js"><link rel="prefetch" href="/frontend/assets/js/14.f49f8c43.js"><link rel="prefetch" href="/frontend/assets/js/15.32af6305.js"><link rel="prefetch" href="/frontend/assets/js/16.b1436089.js"><link rel="prefetch" href="/frontend/assets/js/17.5fc3236e.js"><link rel="prefetch" href="/frontend/assets/js/18.ff5d8014.js"><link rel="prefetch" href="/frontend/assets/js/19.5d39f230.js"><link rel="prefetch" href="/frontend/assets/js/20.aac1b8d3.js"><link rel="prefetch" href="/frontend/assets/js/21.2734a3ce.js"><link rel="prefetch" href="/frontend/assets/js/22.d42af8d0.js"><link rel="prefetch" href="/frontend/assets/js/23.a83d6c9e.js"><link rel="prefetch" href="/frontend/assets/js/24.910a39a5.js"><link rel="prefetch" href="/frontend/assets/js/25.e6bd1806.js"><link rel="prefetch" href="/frontend/assets/js/26.a10914c2.js"><link rel="prefetch" href="/frontend/assets/js/27.2f0a1f63.js"><link rel="prefetch" href="/frontend/assets/js/28.8c33be4a.js"><link rel="prefetch" href="/frontend/assets/js/29.3cf34540.js"><link rel="prefetch" href="/frontend/assets/js/3.4265ed86.js"><link rel="prefetch" href="/frontend/assets/js/30.1d109935.js"><link rel="prefetch" href="/frontend/assets/js/31.766af987.js"><link rel="prefetch" href="/frontend/assets/js/32.2dc4b990.js"><link rel="prefetch" href="/frontend/assets/js/33.45dfc6cb.js"><link rel="prefetch" href="/frontend/assets/js/34.f03b4410.js"><link rel="prefetch" href="/frontend/assets/js/35.58bfb24d.js"><link rel="prefetch" href="/frontend/assets/js/36.8fc8fe18.js"><link rel="prefetch" href="/frontend/assets/js/37.5b21228f.js"><link rel="prefetch" href="/frontend/assets/js/38.1ba642b3.js"><link rel="prefetch" href="/frontend/assets/js/39.d5cc41f1.js"><link rel="prefetch" href="/frontend/assets/js/4.92bd4596.js"><link rel="prefetch" href="/frontend/assets/js/40.d5c211ae.js"><link rel="prefetch" href="/frontend/assets/js/41.a0c3a0a0.js"><link rel="prefetch" href="/frontend/assets/js/42.a2071f24.js"><link rel="prefetch" href="/frontend/assets/js/43.46eaa987.js"><link rel="prefetch" href="/frontend/assets/js/44.87154a9b.js"><link rel="prefetch" href="/frontend/assets/js/45.cfd97f4b.js"><link rel="prefetch" href="/frontend/assets/js/46.47869390.js"><link rel="prefetch" href="/frontend/assets/js/47.806eeabf.js"><link rel="prefetch" href="/frontend/assets/js/5.3c8cd087.js"><link rel="prefetch" href="/frontend/assets/js/6.f11af450.js"><link rel="prefetch" href="/frontend/assets/js/8.11c4b32a.js"><link rel="prefetch" href="/frontend/assets/js/9.6335d493.js">
    <link rel="stylesheet" href="/frontend/assets/css/0.styles.5583c977.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/frontend/" class="home-link router-link-active"><!----> <span class="site-name">whisperwind</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/frontend/browser/" class="nav-link router-link-active">
  浏览器
</a></div><div class="nav-item"><a href="/frontend/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/frontend/javascript/基础语法.html" class="nav-link">
  Javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/frontend/react/" class="nav-link">
  React
</a></li></ul></div></div> <a href="https://gitee.com/whisperw1nd/frontend" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitee
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/frontend/browser/" class="nav-link router-link-active">
  浏览器
</a></div><div class="nav-item"><a href="/frontend/css/" class="nav-link">
  CSS
</a></div><div class="nav-item"><a href="/frontend/javascript/基础语法.html" class="nav-link">
  Javascript
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/frontend/react/" class="nav-link">
  React
</a></li></ul></div></div> <a href="https://gitee.com/whisperw1nd/frontend" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitee
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/frontend/browser/http/HTTP请求流程.html" class="active sidebar-link">HTTP请求流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#浏览器端发起-http-请求流程" class="sidebar-link">浏览器端发起 HTTP 请求流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#构建请求" class="sidebar-link">构建请求</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#查找缓存" class="sidebar-link">查找缓存</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#准备ip和端口" class="sidebar-link">准备IP和端口</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#等待-tcp-队列" class="sidebar-link">等待 TCP 队列</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#建立-tcp-连接" class="sidebar-link">建立 TCP 连接</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#发送-http-请求" class="sidebar-link">发送 HTTP 请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#服务器端处理-http-请求流程" class="sidebar-link">服务器端处理 HTTP 请求流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#协商缓存" class="sidebar-link">协商缓存</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#返回请求" class="sidebar-link">返回请求</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#断开连接" class="sidebar-link">断开连接</a></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#重定向" class="sidebar-link">重定向</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/browser/http/HTTP请求流程.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/frontend/browser/http/HTTP.html" class="sidebar-link">HTTP</a></li><li><a href="/frontend/browser/http/HTTPS.html" class="sidebar-link">HTTPS</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="http请求流程"><a href="#http请求流程" class="header-anchor">#</a> HTTP请求流程</h1> <p>浏览器中的 HTTP 请求从发起到结束一共经历了如下八个阶段：构建请求、查找缓存、准备 IP 和端口、等待 TCP 队列、建立 TCP 连接、发起 HTTP 请求、服务器处理请求、服务器返回请求和断开连接。</p> <p><img src="/frontend/assets/img/httpRequest.1b49976a.png" alt="HTTP请求流程示意图" title="HTTP请求流程示意图"></p> <h2 id="浏览器端发起-http-请求流程"><a href="#浏览器端发起-http-请求流程" class="header-anchor">#</a> 浏览器端发起 HTTP 请求流程</h2> <h3 id="构建请求"><a href="#构建请求" class="header-anchor">#</a> 构建请求</h3> <p>构建请求行信息</p> <div class="language-md extra-class"><pre class="language-md"><code>GET /index.html HTTP1.1
</code></pre></div><h3 id="查找缓存"><a href="#查找缓存" class="header-anchor">#</a> 查找缓存</h3> <p>真正发起网络请求之前，浏览器会先在浏览器缓存中查询是否有要请求的文件(强缓存)。发现请求的资源已经在浏览器缓存中存有副本，并且没有过期，拦截请求，返回该资源的副本，并直接结束请求，而不会再去源服务器重新下载。</p> <p><strong>强缓存</strong>  当浏览器去请求某个文件的时候，服务端就在respone header里面对该文件做了缓存配置。缓存的时间、缓存类型都由服务端控制，具体表现为：srespone header 的cache-control，常见的设置是max-age public private no-cache no-store等</p> <ol><li><p>cache-control: max-age=xxxx，public<br>
客户端和代理服务器都可以缓存该资源；<br>
客户端在xxx秒的有效期内，如果有请求该资源的需求的话就直接读取缓存,statu code:200 ，如果用户做了刷新操作，就向服务器发起http请求</p></li> <li><p>cache-control: max-age=xxxx，private<br>
只让客户端可以缓存该资源；代理服务器不缓存<br>
客户端在xxx秒内直接读取缓存,statu code:200</p></li> <li><p>cache-control: max-age=xxxx，immutable<br>
客户端在xxx秒的有效期内，如果有请求该资源的需求的话就直接读取缓存,statu code:200 ，即使用户做了刷新操作，也不向服务器发起http请求</p></li> <li><p>cache-control: no-cache<br>
跳过设置强缓存，但是不妨碍设置协商缓存；一般如果你做了强缓存，只有在强缓存失效了才走协商缓存的，设置了no-cache就不会走强缓存了，每次请求都回询问服务端。</p></li> <li><p>cache-control: no-store<br>
不缓存，这个会让客户端、服务器都不缓存，也就没有所谓的强缓存、协商缓存了。</p></li></ol> <h3 id="准备ip和端口"><a href="#准备ip和端口" class="header-anchor">#</a> 准备IP和端口</h3> <p>http和tcp的关系：HTTP协议属于应用层，TCP协议属于传输层，HTTP协议位于TCP协议的上层。请求方要发送的数据包，在应用层加上HTTP头以后会交给传输层的TCP协议处理，应答方接收到的数据包，在传输层拆掉TCP头以后交给应用层的HTTP协议处理。建立 TCP 连接后会顺序收发数据，请求方和应答方都必须依据 HTTP 规范构建和解析HTTP报文。</p> <p><img src="/frontend/assets/img/tcp.943ac29f.png" alt="tcp"></p> <p><img src="/frontend/assets/img/tcp&amp;http.1277f342.png" alt="tcp&amp;http"></p> <p>第一步浏览器会请求 DNS 返回域名对应的 IP(浏览器还提供了 DNS 数据缓存服务，如果某个域名已经解析过了，那么浏览器会缓存解析的结果，以供下次查询时直接使用)</p> <p>通常情况下，如果 URL 没有特别指明端口号，那么 HTTP 协议默认是 80 端口</p> <h3 id="等待-tcp-队列"><a href="#等待-tcp-队列" class="header-anchor">#</a> 等待 TCP 队列</h3> <p>chrome下同一个域名同时最多只能建立 6 个 TCP 连接，如果当前请求数量少于 6，会直接进入下一步，建立 TCP 连接，否则进入排队等待状态，直至进行中的请求完成。</p> <h3 id="建立-tcp-连接"><a href="#建立-tcp-连接" class="header-anchor">#</a> 建立 TCP 连接</h3> <p>这个阶段是通过“三次握手”来建立客户端和服务器之间的连接。TCP 提供面向连接的通信传输。面向连接是指在数据通信开始之前先做好两端之间的准备工作。所谓三次握手，是指在建立一个 TCP 连接时，客户端和服务器总共要发送三个数据包以确认连接的建立。</p> <h3 id="发送-http-请求"><a href="#发送-http-请求" class="header-anchor">#</a> 发送 HTTP 请求</h3> <p>浏览器会向服务器发送请求行，它包括了请求方法、请求 URI（Uniform Resource Identifier）和 HTTP 版本协议。如果使用 POST 方法，那么浏览器还要准备数据给服务器，这里准备的数据是通过请求体来发送。</p> <p><strong>数据传输中的TCP</strong>  传输数据阶段，接收端需要对每个数据包进行确认操作，也就是接收端在接收到数据包之后，需要发送确认数据包给发送端。所以当发送端发送了一个数据包之后，在规定时间内没有接收到接收端反馈的确认消息，则判断为数据包丢失，并触发发送端的重发机制。同样，一个大的文件在传输过程中会被拆分成很多小的数据包，这些数据包到达接收端后，接收端会按照 TCP 头中的序号为其排序，从而保证组成完整的数据。</p> <h2 id="服务器端处理-http-请求流程"><a href="#服务器端处理-http-请求流程" class="header-anchor">#</a> 服务器端处理 HTTP 请求流程</h2> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <p>请求资源时，把用户本地该资源的 etag 同时带到服务端，服务端和最新资源做对比。<br>
如果资源没更改，返回304，浏览器读取本地缓存。<br>
如果资源有更改，返回200，返回最新的资源。</p> <h3 id="返回请求"><a href="#返回请求" class="header-anchor">#</a> 返回请求</h3> <p>状态码表示处理结果。返回给浏览器响应头、响应体</p> <h3 id="断开连接"><a href="#断开连接" class="header-anchor">#</a> 断开连接</h3> <p>通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接，断开连接时通过四次挥手断开<br>
如果设置<code>Connection:Keep-Alive</code>，那么 TCP 连接在发送后将仍然保持打开状态。保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度。</p> <h3 id="重定向"><a href="#重定向" class="header-anchor">#</a> 重定向</h3> <p>响应行返回的状态码是 301，就是告诉浏览器，我需要重定向到另外一个网址，而需要重定向的网址正是包含在响应头的 Location 字段中，浏览器获取 Location 字段中的地址，并使用该地址重新导航，这就是一个完整重定向的执行流程。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://www.jianshu.com/p/9c95db596df5" target="_blank" rel="noopener noreferrer">彻底弄懂强缓存与协商缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://time.geekbang.org/column/article/116588" target="_blank" rel="noopener noreferrer">HTTP请求流程：为什么很多站点第二次打开速度会很快？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://time.geekbang.org/column/article/113550" target="_blank" rel="noopener noreferrer">TCP协议：如何保证页面文件能被完整送达浏览器？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/31/2020, 10:17:41 AM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/frontend/browser/http/HTTP.html">
        HTTP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/frontend/assets/js/app.9af0d489.js" defer></script><script src="/frontend/assets/js/2.92dfc871.js" defer></script><script src="/frontend/assets/js/7.dbd79068.js" defer></script>
  </body>
</html>
